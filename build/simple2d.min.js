var $jscomp={scope:{},checkStringArgs:function(f,b,a){if(null==f)throw new TypeError("The 'this' value for String.prototype."+a+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+a+" must not be a regular expression");return f+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(f,b,a){if(a.get||a.set)throw new TypeError("ES3 does not support getters and setters.");f!=Array.prototype&&f!=Object.prototype&&(f[b]=a.value)};$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(f,b,a,p){if(b){a=$jscomp.global;f=f.split(".");for(p=0;p<f.length-1;p++){var m=f[p];m in a||(a[m]={});a=a[m]}f=f[f.length-1];p=a[f];b=b(p);b!=p&&null!=b&&$jscomp.defineProperty(a,f,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("String.prototype.includes",function(f){return f?f:function(b,a){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,a||0)}},"es6-impl","es3");
(function(f){if("undefined"!==typeof this.S2D)return console.warn("Simple 2D already loaded! Loading twice may cause problems."),this.S2D;var b=this.S2D={};b.GL={};Object.defineProperty(b,"FIXED",{value:1});Object.defineProperty(b,"SCALE",{value:2});Object.defineProperty(b,"STRETCH",{value:3});Object.defineProperty(b,"KEY_DOWN",{value:1});Object.defineProperty(b,"KEY_HELD",{value:2});Object.defineProperty(b,"KEY_UP",{value:3});Object.defineProperty(b,"MOUSE_DOWN",{value:1});Object.defineProperty(b,
"MOUSE_UP",{value:2});Object.defineProperty(b,"MOUSE_SCROLL",{value:3});Object.defineProperty(b,"MOUSE_MOVE",{value:4});Object.defineProperty(b,"MOUSE_LEFT",{value:5});Object.defineProperty(b,"MOUSE_MIDDLE",{value:6});Object.defineProperty(b,"MOUSE_RIGHT",{value:7});Object.defineProperty(b,"MOUSE_X1",{value:8});Object.defineProperty(b,"MOUSE_X2",{value:9});Object.defineProperty(b,"MOUSE_SCROLL_NORMAL",{value:10});Object.defineProperty(b,"MOUSE_SCROLL_INVERTED",{value:11});b.Event={which:null,type:null,
button:null,key:null,x:0,y:0,delta_x:0,delta_y:0,direction:null};b.Color={r:1,g:1,b:1,a:1};b.Window={title:null,width:null,height:null,orig_width:null,orig_height:null,viewport:{width:null,height:null,mode:null},pixel_ratio:null,update:null,render:null,mouse:{x:0,y:0,last_x:0,last_y:0},on_key:null,on_mouse:null,element:null,canvas:null,background:null,frames:0,close:!1};b.Image={texture:null,data:null,color:null,x:0,y:0,width:null,height:null,orig_width:null,orig_height:null};b.Sprite={img:null,color:null,
x:0,y:0,width:null,height:null,clip_width:null,clip_height:null,tx1:null,ty1:null,tx2:null,ty2:null,tx3:null,ty3:null,tx4:null,ty4:null};b.Text={texture:null,data:null,color:null,x:0,y:0,width:null,height:null,font:null,size:null,msg:null};b.Sound={data:null};b.Music={data:null};b.current_music=null;b.keys_down=[];b.key_map={27:"Escape",192:"`",189:"-",187:"=",8:"Backspace",9:"Tab",219:"[",221:"]",220:"\\",20:"CapsLock",186:";",222:"'",13:"Return",16:"Shift",188:",",190:".",191:"/",17:"Ctrl",18:"Option",
91:"Left Command",32:"Space",93:"Right Command",37:"Left",38:"Up",39:"Right",40:"Down"};b.GetKey=function(c){return"string"==typeof c?c:b.key_map[c]?b.key_map[c]:String.fromCharCode(c)};b.TrimCanvas=function(c){var b=c.getContext("2d"),a=document.createElement("canvas").getContext("2d"),l=b.getImageData(0,0,c.width,c.height),e=l.data.length,k,g=null,u=null,q=null,t=null,r,f;for(k=0;k<e;k+=4)0!==l.data[k+3]&&(r=k/4%c.width,f=~~(k/4/c.width),null===g&&(g=f),null===u?u=r:r<u&&(u=r),null===q?q=r:q<r&&
(q=r),null===t?t=f:t<f&&(t=f));c=t-g;q-=u;b=b.getImageData(u,g,q,c);a.canvas.width=q;a.canvas.height=c;a.putImageData(b,0,0);return a.canvas};(function(c,b){function a(b,a,h,l){b[e](d+a,"wheel"==k?h:function(b){!b&&(b=c.event);var a={originalEvent:b,target:b.target||b.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==b.type?0:1,deltaX:0,deltaY:0,deltaZ:0,preventDefault:function(){b.preventDefault?b.preventDefault():b.returnValue=!1}};"mousewheel"==k?(a.deltaY=-.025*b.wheelDelta,b.wheelDeltaX&&
(a.deltaX=-.025*b.wheelDeltaX)):a.deltaY=b.detail;return h(a)},l||!1)}var d="",e,k;c.addEventListener?e="addEventListener":(e="attachEvent",d="on");k="onwheel"in b.createElement("div")?"wheel":b.onmousewheel!==f?"mousewheel":"DOMMouseScroll";c.addWheelListener=function(c,b,d){a(c,k,b,d);"DOMMouseScroll"==k&&a(c,"MozMousePixelScroll",b,d)}})(window,document);b.DrawTriangle=function(c,a,h,l,e,k,g,u,q,f,r,m,n,p,w,x,y,C){b.GL.DrawTriangle(c,a,h,l,e,k,g,u,q,f,r,m,n,p,w,x,y,C)};b.DrawQuad=function(c,a,
h,l,e,k,g,u,q,f,r,m,n,p,w,x,y,C,v,z,A,G,H,B){b.GL.DrawTriangle(c,a,h,l,e,k,g,u,q,f,r,m,n,p,w,x,y,C);b.GL.DrawTriangle(n,p,w,x,y,C,v,z,A,G,H,B,c,a,h,l,e,k)};b.DrawLine=function(c,a,h,l,e,k,g,u,q,f,m,n,p,v,w,x,y,C,z,A,B){var d=Math.sqrt(Math.pow(c-h,2)+Math.pow(a-l,2)),t=(h-c)/d*e/2;e=(l-a)/d*e/2;b.DrawQuad(c-e,a+t,k,g,u,q,c+e,a-t,f,m,n,p,h+e,l-t,v,w,x,y,h-e,l+t,C,z,A,B)};b.CreateImage=function(c,a){var d=Object.create(b.Image);d.data=new Image;d.color=Object.create(b.Color);d.data.onload=function(){d.texture=
b.GL.CreateTexture(this);d.width||(d.width=this.width);d.height||(d.height=this.height);a&&a()};d.data.src=c;return d};b.DrawImage=function(c){c&&b.GL.DrawImage(c)};b.CreateSprite=function(c){var a=Object.create(b.Sprite);a.color=Object.create(b.Color);a.img=b.CreateImage(c,function(){a.width||(a.width=a.img.width);a.height||(a.height=a.img.height);a.clip_width=a.img.width;a.clip_height=a.img.height});a.tx1=0;a.ty1=0;a.tx2=1;a.ty2=0;a.tx3=1;a.ty3=1;a.tx4=0;a.ty4=1;return a};b.ClipSprite=function(c,
b,a,l,e){if(c){var d=l/c.img.width,h=e/c.img.height;b*=d;a*=h;d*=l;h*=e;c.tx1=b/l;c.ty1=a/e;c.tx2=(b+d)/l;c.ty2=a/e;c.tx3=(b+d)/l;c.ty3=(a+h)/e;c.tx4=b/l;c.ty4=(a+h)/e;c.width=c.width/c.clip_width*l;c.height=c.height/c.clip_height*e;c.clip_width=l;c.clip_height=e}};b.DrawSprite=function(c){c&&b.GL.DrawSprite(c)};b.CreateText=function(c,a,h){var d=Object.create(b.Text);d.color=Object.create(b.Color);d.font=c?c:null;d.msg=a;d.size=h;b.SetText(d,d.msg);return d};b.SetText=function(c,a){if(""!=a){c.texture&&
b.GL.FreeTexture(c.texture);var d=document.createElement("canvas").getContext("2d"),l=2*c.size;d.canvas.width=1E3;d.canvas.height=1E3;d.font=l+"px "+c.font;d.textAlign="right";d.textBaseline="bottom";d.fillStyle="white";d.fillText(a,1E3,1E3);c.data=b.TrimCanvas(d.canvas);c.texture=b.GL.CreateTexture(c.data);c.width=c.data.width/2;c.height=c.data.height/2}};b.DrawText=function(c){c&&(c.texture||b.SetText(c,c.msg),b.GL.DrawText(c))};b.CreateSound=function(c){var a=Object.create(b.Sound);a.data=new Audio(c);
return a};b.PlaySound=function(c){c.data.cloneNode(!0).play()};b.CreateMusic=function(c){var a=Object.create(b.Music);a.data=new Audio(c);return a};b.PlayMusic=function(c,a){b.StopMusic();c.data.loop=a;b.current_music=c.data;b.current_music.play()};b.PauseMusic=function(){b.current_music&&b.current_music.pause()};b.ResumeMusic=function(){b.current_music&&b.current_music.play()};b.StopMusic=function(){b.current_music&&(b.current_music.pause(),b.current_music.currentTime=0)};b.FadeOutMusic=function(c){if(b.current_music)if(b.current_music.paused)b.StopMusic();
else var a=setInterval(function(){.05<=b.current_music.volume?b.current_music.volume-=.05:(b.StopMusic(),b.current_music.volume=1,clearInterval(a))},c/20)};b.GetMouseOnViewport=function(c,a,h){var d,e;switch(c.viewport.mode){case b.FIXED:d=a/(c.orig_width/c.viewport.width);e=h/(c.orig_height/c.viewport.height);break;case b.SCALE:e=b.GL.GetViewportScale(c);d=1*a/e.scale-(c.width-e.w)/(2*e.scale);e=1*h/e.scale-(c.height-e.h)/(2*e.scale);break;case b.STRETCH:d=a*c.viewport.width/c.width,e=h*c.viewport.height/
c.height}return{x:d,y:e}};b.GetMouseButtonName=function(c){switch(c){case 0:return b.MOUSE_LEFT;case 1:return b.MOUSE_MIDDLE;case 2:return b.MOUSE_RIGHT;case 3:return b.MOUSE_X1;case 4:return b.MOUSE_X2}};b.CreateWindow=function(c,a,h,l,e,f,g){g=Object.create(b.Window);g.title=c;g.width=a;g.height=h;g.orig_width=a;g.orig_height=h;g.viewport.width=a;g.viewport.height=h;g.viewport.mode=b.SCALE;g.update=l;g.render=e;g.background=Object.create(b.Color);g.background.r=0;g.background.g=0;g.background.b=
0;g.background.a=1;g.element="string"==typeof f?document.getElementById(f):f;return g};b.Show=function(c){function a(c){c.close?cancelAnimationFrame(f):(b.GL.Clear(c.background),c.frames++,k=new Date,g=k.getTime()-e.getTime(),c.fps=c.frames/(g/1E3),b.keys_down.forEach(function(a){if(c.on_key){var d=Object.create(b.Event);d.type=b.KEY_HELD;d.key=a;c.on_key(d)}}),c.update&&c.update(),c.render&&c.render(),requestAnimationFrame(function(){a(c)}))}var h=document.createElement("canvas");c.element.appendChild(h);
h.setAttribute("width",c.width);h.setAttribute("height",c.height);h.innerHTML="Your browser doesn't appear to supportthe <code>&lt;canvas&gt;</code> element.";c.canvas=h;c.canvas.addEventListener("contextmenu",function(c){c.preventDefault()});c.canvas.style.width=c.width+"px";c.canvas.style.height=c.height+"px";h=window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||window.opDevicePixelRatio||1;c.canvas.width=c.width*devicePixelRatio;c.canvas.height=c.height*devicePixelRatio;
c.pixel_ratio=h;b.GL.Init(c);b.onkeydown=function(a){if(c.on_key&&(a=b.GetKey(a.keyCode),!b.keys_down.includes(a))){b.keys_down.push(a);var d=Object.create(b.Event);d.type=b.KEY_DOWN;d.key=a;c.on_key(d)}};document.addEventListener("keydown",b.onkeydown);b.onkeyup=function(a){if(c.on_key){a=b.GetKey(a.keyCode);var d=b.keys_down.indexOf(a);-1<d&&b.keys_down.splice(d,1);d=Object.create(b.Event);d.type=b.KEY_UP;d.key=a;c.on_key(d)}};document.addEventListener("keyup",b.onkeyup);window.addEventListener("blur",
function(){var c={};b.keys_down.slice().forEach(function(a){c.keyCode=a;b.onkeyup(c)})});b.onmousedown=function(a){if(c.on_mouse){var d=b.GetMouseOnViewport(c,a.pageX-c.canvas.offsetLeft,a.pageY-c.canvas.offsetTop),e=Object.create(b.Event);e.type=b.MOUSE_DOWN;e.button=b.GetMouseButtonName(a.button);e.x=d.x;e.y=d.y;c.on_mouse(e)}};document.addEventListener("mousedown",b.onmousedown);b.onmouseup=function(a){if(c.on_mouse){var d=b.GetMouseOnViewport(c,a.pageX-c.canvas.offsetLeft,a.pageY-c.canvas.offsetTop),
e=Object.create(b.Event);e.type=b.MOUSE_UP;e.button=b.GetMouseButtonName(a.button);e.x=d.x;e.y=d.y;c.on_mouse(e)}};document.addEventListener("mouseup",b.onmouseup);b.onmousemove=function(a){a=b.GetMouseOnViewport(c,a.pageX-c.canvas.offsetLeft,a.pageY-c.canvas.offsetTop);c.mouse.x=a.x;c.mouse.y=a.y;if(c.on_mouse){var d=Object.create(b.Event);d.type=b.MOUSE_MOVE;d.x=a.x;d.y=a.y;d.delta_x=a.x-c.mouse.last_x;d.delta_y=a.y-c.mouse.last_y;c.on_mouse(d);c.mouse.last_x=a.x;c.mouse.last_y=a.y}};document.addEventListener("mousemove",
b.onmousemove);b.onmousewheel=function(a){if(c.on_mouse){var d=Object.create(b.Event);d.type=b.MOUSE_SCROLL;d.direction=a.webkitDirectionInvertedFromDevice?b.MOUSE_SCROLL_INVERTED:b.MOUSE_SCROLL_NORMAL;d.delta_x=a.deltaX;d.delta_y=a.deltaY;c.on_mouse(d)}a.preventDefault()};window.addWheelListener(document,b.onmousewheel);var f,e=new Date,k=new Date,g;f=requestAnimationFrame(function(){a(c)})};b.Close=function(c){c.close=!0};var a=null,p=[0,1,2,2,3,0],m,z,A,n,B,D,E,F,v=[0,0,0,0,0,0,0,0,0,0,0,0,-1,
1,-1,1];b.GL.Init=function(c){try{a=c.canvas.getContext("webgl")||c.canvas.getContext("experimental-webgl")}catch(d){console.log("GL error caught")}if(!a)return console.error("Unable to initialize WebGL. Your browser may not support it."),null;b.GL.WebGLInit();b.GL.SetViewport(c)};b.GL.WebGLInit=function(){a.enable(a.BLEND);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);var c=b.GL.LoadShader(a.VERTEX_SHADER,"\n    uniform mat4 u_matrix;\n    attribute vec4 a_position;\n    attribute vec4 a_color;\n    attribute vec2 a_texcoord;\n    varying vec4 v_color;\n    varying vec2 v_texcoord;\n    void main(void) {\n      v_color = a_color;\n      v_texcoord = a_texcoord;\n      gl_Position = u_matrix * a_position;\n    }",
"Vertex"),d=b.GL.LoadShader(a.FRAGMENT_SHADER,"\n    precision mediump float;\n    varying vec4 v_color;\n    void main(void) {\n      gl_FragColor = v_color;\n    }","Fragment"),h=b.GL.LoadShader(a.FRAGMENT_SHADER,"\n    precision mediump float;\n    varying vec4 v_color;\n    varying vec2 v_texcoord;\n    uniform sampler2D s_texture;\n    void main(void) {\n      gl_FragColor = texture2D(s_texture, v_texcoord) * v_color;\n    }","Texture Fragment");m=a.createProgram();a.attachShader(m,c);a.attachShader(m,
d);a.linkProgram(m);a.getProgramParameter(m,a.LINK_STATUS)||console.error("Unable to initialize the shader program.");z=a.getAttribLocation(m,"a_position");A=a.getAttribLocation(m,"a_color");n=a.createProgram();a.attachShader(n,c);a.attachShader(n,h);a.linkProgram(n);a.getProgramParameter(n,a.LINK_STATUS)||console.error("Unable to initialize the texture shader program.");B=a.getAttribLocation(n,"a_position");D=a.getAttribLocation(n,"a_color");E=a.getAttribLocation(n,"a_texcoord");F=a.getUniformLocation(n,
"s_texture")};b.GL.LoadShader=function(c,b,h){c=a.createShader(c);a.shaderSource(c,b);a.compileShader(c);return a.getShaderParameter(c,a.COMPILE_STATUS)?c:(console.error('Error compiling shader "'+h+'":\n'+a.getShaderInfoLog(c)),null)};b.GL.GetViewportScale=function(c){var a=Math.min(c.width/c.viewport.width,c.height/c.viewport.height);return{w:c.viewport.width*a,h:c.viewport.height*a,scale:a}};b.GL.SetViewport=function(c){var d=c.viewport.width,h=c.viewport.height,f,e,k,g;e=f=0;k=c.width;g=c.height;
switch(c.viewport.mode){case b.FIXED:k=c.orig_width;g=c.orig_height;e=c.height-g;break;case b.SCALE:e=b.GL.GetViewportScale(c),f=c.width/2-e.w/2,e=c.height/2-e.h/2}a.viewport(f*c.pixel_ratio,e*c.pixel_ratio,k*c.pixel_ratio,g*c.pixel_ratio);v[0]=2/d;v[5]=-2/h;a.useProgram(m);a.uniformMatrix4fv(a.getUniformLocation(m,"u_matrix"),!1,new Float32Array(v));a.useProgram(n);a.uniformMatrix4fv(a.getUniformLocation(n,"u_matrix"),!1,new Float32Array(v))};b.GL.Clear=function(c){a.clearColor(c.r,c.g,c.b,c.a);
a.clear(a.COLOR_BUFFER_BIT)};b.GL.CreateTexture=function(c){if(a){var b=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindTexture(a.TEXTURE_2D,null);return b}};b.GL.FreeTexture=function(c){a.deleteTexture(c)};
b.GL.DrawTriangle=function(c,b,f,l,e,k,g,n,p,t,r,v,B,D,w,x,y,C){c=[c,b,0,g,n,0,B,D,0];f=[f,l,e,k,p,t,r,v,w,x,y,C];a.useProgram(m);a.bindBuffer(a.ARRAY_BUFFER,a.createBuffer());a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW);a.vertexAttribPointer(z,3,a.FLOAT,!1,0,0);a.enableVertexAttribArray(z);a.bindBuffer(a.ARRAY_BUFFER,a.createBuffer());a.bufferData(a.ARRAY_BUFFER,new Float32Array(f),a.STATIC_DRAW);a.vertexAttribPointer(A,4,a.FLOAT,!1,0,0);a.enableVertexAttribArray(A);a.drawArrays(a.TRIANGLES,
0,3)};b.GL.DrawTexture=function(c,b,f,l,e,k,g,m,q,t,r,v,z,A,w,x,y){c=[c,b,0,q,t,c+f,b,0,r,v,c+f,b+l,0,z,A,c,b+l,0,w,x];e=[e,k,g,m,e,k,g,m,e,k,g,m,e,k,g,m];a.useProgram(n);a.bindBuffer(a.ARRAY_BUFFER,a.createBuffer());a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW);a.vertexAttribPointer(B,3,a.FLOAT,!1,20,0);a.enableVertexAttribArray(B);a.vertexAttribPointer(E,2,a.FLOAT,!1,20,12);a.enableVertexAttribArray(E);a.bindBuffer(a.ARRAY_BUFFER,a.createBuffer());a.bufferData(a.ARRAY_BUFFER,new Float32Array(e),
a.STATIC_DRAW);a.vertexAttribPointer(D,4,a.FLOAT,!1,0,0);a.enableVertexAttribArray(D);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,y);a.uniform1i(F,0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,a.createBuffer());a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(p),a.STATIC_DRAW);a.drawElements(a.TRIANGLES,p.length,a.UNSIGNED_SHORT,0)};b.GL.DrawImage=function(a){b.GL.DrawTexture(a.x,a.y,a.width,a.height,a.color.r,a.color.g,a.color.b,a.color.a,0,0,1,0,1,1,0,1,a.texture)};b.GL.DrawSprite=function(a){b.GL.DrawTexture(a.x,
a.y,a.width,a.height,a.color.r,a.color.g,a.color.b,a.color.a,a.tx1,a.ty1,a.tx2,a.ty2,a.tx3,a.ty3,a.tx4,a.ty4,a.img.texture)};b.GL.DrawText=function(a){b.GL.DrawTexture(a.x,a.y,a.width,a.height,a.color.r,a.color.g,a.color.b,a.color.a,0,0,1,0,1,1,0,1,a.texture)}}).call(this);
